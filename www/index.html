<!DOCTYPE html>
<html lang="si">
	<head>
		<title>1. seminarska - OO - AR.js & A-Frame barcodes projekt, 8.2023</title>
		
		<meta charset="UTF-8">
		<meta name="description" content="AR.js projekt za prikaz dodatnih informacij v razširjeni resničnosti z uporabo črtnih kod.">

		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

		<script src="js/info-message.js"></script>
		<script src="js/info-panel.js"></script>
		
		<noscript>JavaScript mora biti omogočena, da lahko spletna stran deluje pravilno!</noscript>
	</head>
	
	<style>
		.controls {
			
		}
		#freeze {
			z-index: 420;
			position: absolute;
			height: 100px;
			width: 100px;
			bottom: -40px;
			left: calc(50% - 50px);
			background-color: red;
			border-radius: 50%;
			cursor: pointer;
			transition: transform 0.7s ease-in-out;
		}
		.show#freeze {
			display: block;
			transform: scale(1);
		}
		.hide#freeze {
			display: none;
			transform: scale(0);
		}
	</style>
	
  <body style="margin : 0px; overflow: hidden;">
		<div class="controls">
			<button type="button" id="freeze" class="hide">scena</button>
		</div>

    <a-scene 
			vr-mode-ui="enabled: false;"
			renderer="logarithmicDepthBuffer: false;"
			info-message="htmlSrc: #infoMsg"
			loading-screen="dotsColor: green"
			arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

			<a-assets>
				<a-asset-item id="infoMsg" src="assets/info.html"></a-asset-item>
			
				<a-asset-item id="box0" src="./test/Box.gltf"></a-asset-item>
				
				<a-mixin id="initial" 
					position="0 0 0"
					geometry="primitive: sphere; radius: 1"
					material="wireframe: true"
				></a-mixin>
				
				<!-- -->
				<img id="kazetachinu" src="https://cdn.aframe.io/examples/ui/kazetachinu.jpg" crossorigin="anonymous"/>
        <img id="kazetachinuPoster" src="https://cdn.aframe.io/examples/ui/kazetachinuPoster.jpg" crossorigin="anonymous"/>
        <!--
          Image source: http://www.ghibli.jp/works/ponyo/#frame&gid=1&pid=36
          Image author: Studio Ghibli
        -->
        <img id="ponyo" src="https://cdn.aframe.io/examples/ui/ponyo.jpg" crossorigin="anonymous"/>
        <img id="ponyoPoster" src="https://cdn.aframe.io/examples/ui/ponyoPoster.jpg" crossorigin="anonymous"/>

        <a-mixin
          id="frame"
          geometry="primitive: plane; width: 0.5783552; height: 0.8192"
          material="color: white; shader: flat"
          animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
          animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
         ></a-mixin>
         <a-mixin
          id="poster"
          geometry="primitive: plane; width: 0.544768; height: 0.786432"
          material="color: white; shader: flat"
          material="shader: flat"
          position="0 0 0.005"
         ></a-mixin>
         <a-mixin
          id="movieImage"
          geometry="primitive: plane; width: 1.5; height: 0.81"
          material="src: #ponyo; shader: flat; transparent: true"
          position="0 0.495 0.002"
         ></a-mixin>
				<!-- -->
			</a-assets>
			
      <a-marker clickable id="zero" markerhandler type="barcode" value="0" smooth="true">
				<a-entity
					mixin="initial"
					class="initial zero"
				></a-entity>
				<a-plane
					class="details zero"
					position="0 0 -1"
					scale="2 2 2"
					visible="false"
					color="#0a0b0c"
				></a-plane>
				<a-text class="details zero" position="-0.5 0 0" visible="false" value="barcode: 0"></a-text>
      </a-marker>
      
			<a-entity camera 
				position="0 0 1.5">
        <!-- look-controls="magicWindowTrackingEnabled: false; touchEnabled: false; mouseEnabled: false"> -->
        <a-entity
          id="fadeBackground"
          geometry="primitive: sphere; radius: 2.5"
          material="color: black; side: back; shader: flat; transparent: true; opacity: 0.6" visible="false">
        </a-entity>
			</a-entity>
			
			<a-entity
        id="background"
        position="0 0 0"
        geometry="primitive: sphere; radius: 2.0"
        material="color: red; side: back; shader: flat"
        scale="0.001 0.001 0.001"
        visible="false">
      </a-entity>
			
			<a-entity id="ui" position="0 0 -2.5">
        <!-- Info panel of the selected movie. -->
        <a-entity
          id="infoPanel"
          position="0 0 0.5"
          info-panel
          visible="false"
          geometry="primitive: plane; width: 1.5; height: 1.8"
          material="color:  #333333;  shader:  flat;  depthWrite:  false;  offset:  [0 0];  repeat:  [0 0]">
          <a-entity id="kazetachinuMovieImage" mixin="movieImage" material="src: #kazetachinu; depthWrite:  false" visible="false"></a-entity>
          <a-entity id="movieTitle"
            position="-0.68 -0.1 0.55"
            text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Ponyo (2003)"></a-entity>
          <a-entity id="movieDescription"
            position="-0.68 -0.2 0.55"
            text="baseline: top; shader: msdf; anchor: left; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.">
					</a-entity>
					<a-text id="closeInfo" position="0.49 0.61 0.55" value="X"></a-text>
        </a-entity>
      </a-entity>
			
			<!-- <a-plane
				class="details zero"
				position="0 0 -1"
				scale="1 1 1"
				visible="false"
			></a-plane>
			<a-text class="details zero" position="-0.5 0 0" visible="false" value="barcode: 0"></a-text>
			<a-sky id="bg" class="details zero" visible="false" color="#d4d4d4" opacity="0.0"
				animation="property: opacity; from: 0.0; to: 0.5; loop: 1; dur: 90000;"
			></a-sky> -->
    </a-scene>
	
	<script>
		function toggleVisibility(el) {
			//console.log(el.classList)
			if (el.classList[0] == "hide") {
				el.classList = 'show';
			} else {
				el.classList = 'hide';
			}
		}
	
		document.addEventListener("DOMContentLoaded", () => {
			let camera = document.querySelector('a-entity[camera]').components["camera"];
			let currentEntity = {}
			currentEntity.isPlaying = false
			let freeze = document.querySelector("#freeze")
		
			AFRAME.registerComponent('markerhandler', {
				init: function () {
					this.el.sceneEl.addEventListener('markerFound', (e) => {
						if (!currentEntity.isPlaying) {
							toggleVisibility(freeze)
							currentEntity = document.querySelector(`#${e.target.id}`).components["arjs-anchor"];						
						}
					})
					this.el.sceneEl.addEventListener('markerLost', (e) => {
						if (currentEntity.isPlaying) {
							toggleVisibility(freeze)
							currentEntity = {}
							currentEntity.isPlaying = false	
						}
					})
				}
			});
			
			AFRAME.registerComponent("clickable", {
				init: function () {
					this.el.sceneEl.addEventListener('click', this.handleClick.bind(this));
				},
				handleClick: function (e) {
					if (currentEntity.el && this.el.id == currentEntity.el.id) { //} && e.target.className != "a-canvas") {
						console.log(e)
						let id = currentEntity.el.id
						let initial = document.querySelector(`.initial.${id}`)
						initial.setAttribute("visible", !initial.getAttribute("visible"))						
						
						let movieImageEl;
						let movieTitleEl = document.querySelector('#movieTitle');
						let movieDescriptionEl = document.querySelector('#movieDescription');

						let movieInfo = {
							zero: {
								title: 'The Wind Rises (2013)',
								imgEl: document.querySelector('#kazetachinuMovieImage'),
								description: 'The Wind Rises is a fictionalised biographical film of Jiro Horikoshi (1903, 1982), designer of the Mitsubishi A5M fighter aircraft and its successor, the Mitsubishi A6M Zero, used by the Empire of Japan during World War II. The film is adapted from Miyazaki\'s manga of the same name, which was in turn loosely based on both the 1937 novel The Wind Has Risen by Tatsuo Hori and the life of Jiro Horikoshi.'
							}
						};
						var minfo = movieInfo[id];

						let info = document.querySelector("#infoPanel").components["info-panel"]
						//console.log(info, minfo)
						info.el.object3D.scale.set(1, 1, 1);
						if (AFRAME.utils.device.isMobile()) { info.el.object3D.scale.set(1.4, 1.4, 1.4); }
						info.el.object3D.visible = !info.el.object3D.visible //true;

						if (movieImageEl) { movieImageEl.object3D.visible = !movieImageEl.object3D.visible; } //false; }
						movieImageEl = minfo.imgEl;
						movieImageEl.object3D.visible = !movieImageEl.object3D.visible //true;

						movieTitleEl.setAttribute('text', 'value', minfo.title);
						movieDescriptionEl.setAttribute('text', 'value', minfo.description);
					}
				}
			})
			
			//init()
			/*const clickables = document.querySelector('[clickable]');
			console.log(clickables)
			clickables.addEventListener('clickable-click', function (event) {
				console.log('Clicked!', event.detail);
			});*/
			
			
			freeze.addEventListener("click", () => {
				//console.log(currentEntity)
				if (!currentEntity.isPlaying) {
					currentEntity.play()
				} else {
					currentEntity.pause()
				}
			})
		});
	</script>

  </body>
</html>





<!-- <!DOCTYPE html>
<html lang="si">
	<head>
		<title>1. seminarska - OO - AR.js & A-Frame barcodes projekt, 8.2023</title>
		
		<meta charset="UTF-8">
		<meta name="description" content="AR.js projekt za prikaz dodatnih informacij v razširjeni resničnosti z uporabo črtnih kod.">

		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

		<script src="js/info-message.js"></script>
		<script src="js/info-panel.js"></script>
		
		<noscript>JavaScript mora biti omogočena, da lahko spletna stran deluje pravilno!</noscript>
	</head>
	
	<style>
		.controls {
			
		}
		#freeze {
			z-index: 420;
			position: absolute;
			height: 100px;
			width: 100px;
			bottom: -40px;
			left: calc(50% - 50px);
			background-color: red;
			border-radius: 50%;
			cursor: pointer;
			transition: transform 0.7s ease-in-out;
		}
		.show#freeze {
			display: block;
			transform: scale(1);
		}
		.hide#freeze {
			display: none;
			transform: scale(0);
		}
	</style>
	
  <body style="margin : 0px; overflow: hidden;">
		<div class="controls">
			<button type="button" id="freeze" class="hide">scena</button>
		</div>

    <a-scene 
			vr-mode-ui="enabled: false;"
			renderer="logarithmicDepthBuffer: true;"
			cursor="rayOrigin: mouse; fuse: false" raycaster="objects: .raycastable"
			info-message="htmlSrc: #infoMsg"
			arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

			<a-assets>
				<a-asset-item id="infoMsg" src="assets/info.html"></a-asset-item>
			
				<a-asset-item id="box0" src="./test/Box.gltf"></a-asset-item>
				
				<a-mixin id="initial" 
					position="0 0 0"
					geometry="primitive: sphere; radius: 0.7"
				></a-mixin>

				<img id="kazetachinu" src="https://cdn.aframe.io/examples/ui/kazetachinu.jpg" crossorigin="anonymous"/>
        <img id="kazetachinuPoster" src="https://cdn.aframe.io/examples/ui/kazetachinuPoster.jpg" crossorigin="anonymous"/>

        <img id="ponyo" src="https://cdn.aframe.io/examples/ui/ponyo.jpg" crossorigin="anonymous"/>
        <img id="ponyoPoster" src="https://cdn.aframe.io/examples/ui/ponyoPoster.jpg" crossorigin="anonymous"/>

        <a-mixin
          id="frame"
          geometry="primitive: plane; width: 0.5783552; height: 0.8192"
          material="color: white; shader: flat"
          animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
          animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
         ></a-mixin>
         <a-mixin
          id="poster"
          geometry="primitive: plane; width: 0.544768; height: 0.786432"
          material="color: white; shader: flat"
          material="shader: flat"
          position="0 0 0.005"
         ></a-mixin>
         <a-mixin
          id="movieImage"
          geometry="primitive: plane; width: 1.5; height: 0.81"
          material="src: #ponyo; shader: flat; transparent: true"
          position="0 0.495 0.002"
         ></a-mixin>
			</a-assets>
			
      <a-marker clickable id="kazetachinuButton" markerhandler type="barcode" value="0">
				<a-entity
					mixin="initial"
					class="raycastable"
				></a-entity>
				<a-plane
					class="details zero"
					position="0 0 -1"
					scale="2 2 2"
					visible="false"
					color="#0a0b0c"
				></a-plane>
				<a-text class="details zero" position="-0.5 0 0" visible="false" value="barcode: 0"></a-text>
      </a-marker>
      
			<a-entity camera 
				position="0 1.6 0"
        look-controls="magicWindowTrackingEnabled: false; touchEnabled: false; mouseEnabled: false">
        <a-entity
          id="fadeBackground"
          geometry="primitive: sphere; radius: 2.5"
          material="color: black; side: back; shader: flat; transparent: true; opacity: 0.6" visible="false">
        </a-entity></a-entity>
			
			<a-entity
        id="background"
        position="0 0 0"
        geometry="primitive: sphere; radius: 2.0"
        material="color: red; side: back; shader: flat"
        scale="0.001 0.001 0.001"
        visible="false" class="raycastable">
      </a-entity>
			
			<a-entity id="ui" position="0 1.6 -2.5">
        <a-entity id="menu" highlight>
          <a-entity clickable id="ponyoButton" position="0.8 0 0" mixin="frame" class="raycastable menu-button">
            <a-entity material="src: #ponyoPoster" mixin="poster"></a-entity>
          </a-entity>
        </a-entity>

        <a-entity
          id="infoPanel"
          position="0 0 0.5"
          info-panel
          visible="false"
          scale="0.001 0.001 0.001"
          geometry="primitive: plane; width: 1.5; height: 1.8"
          material="color: #333333; shader: flat; transparent: false" class="raycastable">
          <a-entity id="ponyoMovieImage" mixin="movieImage" material="src: #ponyo" visible="false"></a-entity>
          <a-entity id="kazetachinuMovieImage" mixin="movieImage" material="src: #kazetachinu" visible="false"></a-entity>
          <a-entity id="movieTitle"
            position="-0.68 -0.1 0"
            text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Ponyo (2003)"></a-entity>
          <a-entity id="movieDescription"
            position="-0.68 -0.2 0"
            text="baseline: top; shader: msdf; anchor: left; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."></a-entity>
        </a-entity>
    </a-scene>
	
	<script>
		function toggleVisibility(el) {
			//console.log(el.classList)
			if (el.classList[0] == "hide") {
				el.classList = 'show';
			} else {
				el.classList = 'hide';
			}
		}
	
		document.addEventListener("DOMContentLoaded", () => {
			let camera = document.querySelector('a-entity[camera]').components["camera"];
			//let scene = document.querySelector('a-scene').components;
			let currentEntity = {}
			currentEntity.isPlaying = false
			let freeze = document.querySelector("#freeze")
		
			AFRAME.registerComponent('markerhandler', {
				init: function () {
					this.el.sceneEl.addEventListener('markerFound', (e) => {
						if (!currentEntity.isPlaying) {
							toggleVisibility(freeze)
							currentEntity = document.querySelector(`#${e.target.id}`).components["arjs-anchor"];						
						}
					})
					this.el.sceneEl.addEventListener('markerLost', (e) => {
						if (currentEntity.isPlaying) {
							toggleVisibility(freeze)
							currentEntity = {}
							currentEntity.isPlaying = false	
						}
					})
				}
			});
			
			AFRAME.registerComponent("clickable", {
				init: function() {
				//if (this.el.sceneEl.class)
					console.log(this)
					var buttonEls = document.querySelectorAll('.menu-button');
					console.log(buttonEls)
					
					this.movieImageEl;
					this.movieTitleEl = document.querySelector('#movieTitle');
					this.movieDescriptionEl = document.querySelector('#movieDescription');

					this.movieInfo = {
						kazetachinuButton: {
							title: 'The Wind Rises (2013)',
							imgEl: document.querySelector('#kazetachinuMovieImage'),
							description: 'The Wind Rises is a fictionalised biographical film of Jiro Horikoshi (1903, 1982), designer of the Mitsubishi A5M fighter aircraft and its successor, the Mitsubishi A6M Zero, used by the Empire of Japan during World War II. The film is adapted from Miyazaki\'s manga of the same name, which was in turn loosely based on both the 1937 novel The Wind Has Risen by Tatsuo Hori and the life of Jiro Horikoshi.'
						},
						ponyoButton: {
							title: 'Ponyo (2003)',
							imgEl: document.querySelector('#ponyoMovieImage'),
							description: 'It is the eighth film Miyazaki directed for Studio Ghibli, and his tenth overall. The film tells the story of Ponyo (Nara), a goldfish who escapes from the ocean and is rescued by a five-year-old human boy, Sōsuke (Doi) after she is washed ashore while trapped in a glass jar.'
						}
					};

					this.onMenuButtonClick = this.onMenuButtonClick.bind(this);
					//for (var i = 0; i < buttonEls.length; ++i) {
						console.log("in info")
						this.el.addEventListener('click', this.onMenuButtonClick);
					//}
					/*this.el.sceneEl.addEventListener("click", (e) => {
						if (currentEntity.el && this.el.id == currentEntity.el.id) {
							//console.log(this.el.id)
							//let id = currentEntity.el.id
							//let initial = document.querySelector(`.initial.${id}`)
							//initial.setAttribute("visible", !initial.getAttribute("visible"))
							
							let bg = document.querySelector("#bg")
							for (let i = 0; i <= 0.7; i += 0.0001) {
								bg.setAttribute("opacity", i)
							}
							
							document.querySelectorAll(`.details.${id}`).forEach((d) => {
								d.setAttribute("visible", !d.getAttribute("visible"))
							})
						}
					})*/
				},
				
				onMenuButtonClick: function (evt) {
					console.log(evt.currentTarget.id)
					var movieInfo = this.movieInfo[evt.currentTarget.id];

					let info = document.querySelector("#infoPanel").components["info-panel"]
					console.log(info)
					info.el.object3D.scale.set(1, 1, 1);
					if (AFRAME.utils.device.isMobile()) { info.el.object3D.scale.set(1.4, 1.4, 1.4); }
					info.el.object3D.visible = true;

					if (this.movieImageEl) { this.movieImageEl.object3D.visible = false; }
					this.movieImageEl = movieInfo.imgEl;
					this.movieImageEl.object3D.visible = true;

					this.movieTitleEl.setAttribute('text', 'value', movieInfo.title);
					this.movieDescriptionEl.setAttribute('text', 'value', movieInfo.description);
				},
			})
			
			//console.log("https://github.com/gs1/interpretGS1scan")
			
			freeze.addEventListener("click", () => {
				//console.log(currentEntity)
				if (!currentEntity.isPlaying) {
					currentEntity.play()
				} else {
					currentEntity.pause()
				}
			})
		});
	</script>

  </body>
</html> -->